## TokeNest Work Process
이 문서는 `TokeNest dApps`의 제작 과정과 `원두`라는 상품을 예시로 `TokeNest-DEX`의 세부 동작 방식에 대해 설명합니다.

`2023/07/21`부터 시작해 지속적으로 개발하고 있습니다.

`TokeNest-NFT개발이 구현되면 NFT 섹션도 추가할 예정입니다.`

## TokeNest-DEX
본 섹션에선 TokeNest-DEX를 단순히 `Run`시키는 것이 아닌, 전체적인 `DEX의 흐름`(토큰과 실물 상품의 가격 책정 방식, 스왑 경로 등)에 대해 이해하기 쉽게 설명합니다.


컨트랙트 코드의 정확한 동작 방식에 대해선 [TokeNest-DEX-Specification](./dex-specification.md)를 참고해 주세요. 

### How TokeNest DEX is work?
TokeNest-DEX의 전체적인 동작 흐름은 아래와 같습니다.

```text
1. 판매자는 실물 A 제품에 대응하는 A 토큰을 블록체인에 생성합니다.
2. 판매자는 블록체인에 생성된 A 토큰을 DEX에 상장합니다.
3. 구매자는 A 토큰이 상장된 DEX에서 자신이 가진 스테이블 코인을 통해 Swap 하여 A 토큰을 받습니다.
4. DEX의 풀에는 A 토큰이 적어지고, 스테이블 코인이 많아집니다. (여기서 판매자는 DEX의 지분율만큼 쌓인 스테이블 코인을 획득하여 이익을 봅니다)
5. 구매자는 A 토큰을 실물 A 상품으로 교환할 수 있는 NFT를 NFT 교환 컨트랙트로 교환하여 NFT를 발급받습니다.
6. A 토큰을 NFT로 교환하면 판매자가 DEX에 예금한 A 토큰 지분율에 비례해 A 토큰 판매처가 결정됩니다. 
   - Ex) A, B, C, D, E 판매자의 DEX 지분율이 15, 10, 30, 20, 25%라고 하면 판매자가 NFT 토큰을 교환했을 시 15% 확률로 A 판매자의 원두, 10% 확률로 B 판매자의 원두 교환권을 얻을 수 있다.
7. 구매자는 NFT를 소각 컨트랙트를 통해 소각합니다.
8. 판매자는 해당 소각 컨트랙트를 통해 NFT 소각을 확인 후 실물 A 제품을 배송합니다.
9. 구매자는 실물 A 제품을 완제품으로 가공하여 판매해 고정적인 수익을 창출합니다.
10. 완제품의 가격은 A 토큰의 가격에 따라 실시간으로 변동됩니다.
11. 소비자는 완제품의 실시간 물가를 추적하는 키오스크를 통해 구매할 수 있어 합리적인 소비가 가능합니다.
```
* `2023/09/01`자 기준 1, 2, 3, 4, 10, 11이 구현되어 있습니다.
* 11번 항목의 경우 [TokeNest-Next.js](https://github.com/TokeNest/TokeNest_Next.js)를 참고해 주세요.

위 항목을 `원두`라는 상품으로 예시를 들어보면 아래와 같은 흐름으로 동작하게 됩니다.

```text
1. 원두 판매 업체(판매자)는 자신이 보유한 실물 원두에 대응하는 원두 토큰을 생성합니다. (Ex. 원두 1kg = 원두 토큰 1개)
2. 원두 판매 업체 TokeИest DEX에서 자신의 원두 토큰을 상장합니다.
3. 카페 점주(구매자)는 TokeИest DEX에서 자신이 가진 스테이블 코인을 Swap 하여 원두 토큰을 받습니다. 
4. TokeИest DEX의 원두 토큰 Pool에서는 원두 토큰이 적어지고, 스테이블 코인이 많아집니다. (여기서 원두 판매 업체는 Pool의 지분율만큼 쌓인 스테이블 코인을 획득하여 이익을 봅니다)
5. 카페 점주는 원두 토큰을 TokeИest의 NFT 교환 컨트랙트로 교환하여 실물 원두로 교환 가능한 NFT를 발급받습니다. 
6. 원두 토큰을 NFT로 교환하면 원두 판매 업체가 DEX에 예금한 원두 토큰 지분율에 비례해 원두 판매 업체가 결정됩니다.
7. 카페 점주는 NFT를 소각 컨트랙트를 통해 소각합니다.
8. 원두 판매 업체는 소각 컨트랙트를 통해 NFT 소각을 확인 후 실물 원두를 배송합니다.
9. 카페 점주는 블록체인에서 구매한 실물 원두로 가공한 완제품(아메리카노, 카푸치노 등)을 판매해 원두 물가 대비 고정적인 수익을 창출합니다. 
10. 아메리카노의 가격은 원두 토큰의 가격에 따라 실시간으로 변동됩니다.
11. 카페 점주는 아메리카노에 추가 가격을 붙여 판매함으로 고정적인 이윤 창출이 가능합니다.
12. 손님(소비자)은 아메리카노의 실시간 물가를 추적하는 키오스크를 통해 구매할 수 있어 합리적인 소비가 가능합니다.
```

위의 흐름대로 동작했을 떄 발생할 수 있는 이슈들과 해결책은 다음과 같습니다.
- 가격 우상향
  - 토큰의 거래가 일어나 블록체인의 원두 값이 실물보다 비싸진다면 수요가 없지 않을까요?

`해결책: MultiSig로 발행량을 합의해 가격이 유지되는 선에서 추가 발행을 진행해 우상향 가격을 조정함. (Multisig 투표자는 TokeNest-dApps 회원 기준으로 발행된 안건에 대해 1인 1투표로 결정)`

### TokeNest Distribution Process Simulation
본 섹션에선 TokeNest의 유통과정을 친숙한 `짱구`의 캐릭터들을 주인공으로 시뮬레이션 합니다.

#### Simulation 1. Create Pool Structure
```text
1. 짱구가 초코비 발행 및 풀 구조를 잡습니다.
    1.1. 짱구는 초코비 생산지인 나뭇잎마을에서 실물 초코비 10개를 구매합니다.
    1.2. 짱구가 떡잎마을 방범대에 초코비 토큰 10개를 발행하고 풀에 10개를 예치합니다. 😎(초코비 토큰 * 스테이블 코인10개  = 100)
       - 현재 초코비 풀에서는 짱구 지분율 100%인 상황
       - 풀에 토큰을 예치하기 위해선 해당 금액에 맞는 스테이블코인도 같이 풀에 예치해야 합니다.
    3. 맹구는 초코비 토큰 2개를 구매합니다. 
       - 풀 상황 : (초코비 토큰 8개, 스테이블 코인 12.5개 = 100)
       - 현재 풀 상황에서 짱구가 전부 출금(withdraw)하면 2.5개치의 스테이블 코인을 수익으로 받습니다. 💰
        3.1. 맹구는 실물 초코비 2개 짱구로부터 배송받습니다. 😋
        3.2. 이렇게 되면 초코비 가격은 비싸지게 됩니다!
    4. 초코비 토큰이 비싸졌기 때문에 똑똑한 철수가 다시 초코비 공급하려 합니다. (차익거래 목적)
        4.1. 철수가 실물 초코비 2개를 약 스테이블 2개 가격으로 구매합니다.
        4.2. 철수가 초코비 토큰 2개를 추가 발행하기 위해 TokeNest-DEX에 안건 컨트랙트를 보냅니다.
           - 추가 토큰 발행(mint)는 DAO or Multisig 방식을 통해서 진행됩니다.
           - 떡잎마을 방범대에선 DAO방식을 통해 투표합니다.
                4.2.1. 짱구
                   혼자 초코비 토큰으로 수익을 벌고 싶기 떄문에 NO!! → 반대. 🙅
                4.2.2. 유리, 훈이, 맹구 :
                   철수가 품질이 좋은 초코비를 가져왔고 문제가 없다 판단해 YES!! → 찬성. 👍
                4.2.3. 과반수의 찬성으로 철수는 초코비 2개를 발행에 성공하게 됩니다! 🥳
        4.3. 철수가 풀에서 초코비 토큰 2개를 스왑해 스테이블 코인 2.5개로 교환합니다.
           - 현재 초코비 풀 : 초코비 10개, 스테이블 10개 = 100 (초코비 토큰의 가격은 다시 안정화 되었습니다.)
            4.3.1. 철수는 스테이블 2.5개를 교환하여 스테이블 0.5개만큼의 수익을 창출했습니다. 🤩
               - 철수가 현재 가지고 있는 자산 : 0.5 스테이블 코인, 2 스테이블 값어치의 실물 초코비
```
위 시뮬레이션은 상품을 토큰화 하고싶은 사용자가 어떻게 TokeNest-DEX에서 유동성 풀을 구축할 수 있고, 어떻게 거래가 일어나는지 보여줍니다.

#### Simulation 2. Rising Prices
```text
1. 나뭇잎마을에 대형 산불이 나 실물 초코비 생산량이 급격하게 떨어졌습니다. 🔥
    1.1. 실물 초코비는 약 스테이블 코인 4개 가치로 올랐으나, 현재 초코비 토큰 풀에선 스테이블 코인 2개로 초코비를 구매할 수 있습니다.
2. 초코비 풀의 가격이 실물보다 더 싼 것을 알아챈 이슬이와 광자는 초코비 풀에서 스테이블 코인 2개로 초코비를 마구 삽니다. 🤑
    2.1. 초코비 풀의 초코비 토큰 가격은 실물 초코비 가격에 맞춰 빠르게 상승합니다.
3. 초코비 토큰이 약 스테이블 코인 4개 가격으로 올라간 후에는 다시 4코인 주위에서 거래가 일어납니다.
```
위 시뮬레이션은 물가가 상승할 때 TokeNest-DEX의 풀에서 어떻게 토큰의 가격이 오르는지 정해지는지 보여줍니다.

#### Simulation 3. Falling Prices
```text
1. 이후 떡잎마을에서도 직접 초코비를 재배하기 시작하며 초코비의 생산량이 대폭 증가했습니다. 😏
    1.1. 현재 실물 초코비는 다시 스테이블 코인 2개 가격으로 내렸으나, 현재 초코비 토큰은 스테이블 코인 4개 가격입니다.
2. 똑똑한 철수는 다시 실물 초코비를 스테이블 코인 2개 가격으로 다수 구매한 후 안건 컨트랙트를 보냅니다.
    2.1. Simulation 1을 통해 철수의 신용도는 보장됨으로 과반수 득표로 초코비 토큰 대량 발행에 성공합니다.
3. 초코비 토큰이 대량 발행됨으로 초코비 토큰의 가격은 다시 스테이블 코인 2개 가격으로 내리게 됩니다.
    3.1. 철수는 초코비 토큰을 스테이블 코인으로 스왑하며 이윤을 챙겼습니다. 😎
4. 다시 초코비 토큰은 실물 초코비 가격과 비슷하게 거래가 일어나게 됩니다. 
```
위 시뮬레이션은 물가가 하락할 때 TokeNest-DEX의 풀에서 어떻게 토큰의 가격이 떨어지는지 보여줍니다.

위 시뮬레이션들을 통해 실시간으로 TokeNest-DEX의 토큰들이 실제 물가를 반영하는 과정에 대해 이해하셨으면 좋겠습니다. 😚


## TokeNest-NFT
컨트랙트 개발 완료 후 구축 예정입니다.
